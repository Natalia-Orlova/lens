<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        overflow: hidden;
        touch-action: none; /* Предотвращает скролл при касании */
      }
      #stretchableText {
        width: 90%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        line-height: 32px;
        text-transform: uppercase;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="stretchableText">
        Lorem ipsum dolor sit, amet consectetur adipisicing elit. Perspiciatis,
        porro, sequi placeat quidem sint voluptate, eaque quaerat qui
        dignissimos commodi ex excepturi. Itaque explicabo aliquam laudantium
        voluptatibus quos cumque sed culpa consequuntur iusto repudiandae iure
        animi, odio vitae quasi blanditiis beatae. Quasi iure praesentium quae
        distinctio itaque facilis ipsam eligendi. Lorem ipsum dolor sit amet
        consectetur adipisicing elit. Totam cumque minus ea nam laudantium
        quibusdam. Eveniet earum, aperiam natus beatae, aliquam voluptatibus
        incidunt repudiandae, reiciendis dolorem officia minus fuga obcaecati
        vitae eum. Nemo optio impedit modi facilis, et excepturi expedita
        voluptates voluptatum nisi veritatis reiciendis ratione iste consequatur
        libero tempora!
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
      let textContainer;
      let textParts = [];
      let touchPoints = [];

      function setup() {
        createCanvas(windowWidth, windowHeight);
        textContainer = document.getElementById("stretchableText");
        let text = textContainer.textContent;
        textContainer.innerHTML = "";

        for (let i = 0; i < text.length; i++) {
          let span = document.createElement("span");
          span.textContent = text[i];
          span.style.display = "inline-block";
          span.style.transformOrigin = "center";
          span.style.transform = "scale(1)"; // Устанавливаем изначальный масштаб
          textContainer.appendChild(span);
          textParts.push(span);
        }
      }

      function draw() {
        background(255);

        for (let i = 0; i < textParts.length; i++) {
          let part = textParts[i];
          let partRect = part.getBoundingClientRect();
          let partCenterX = partRect.left + partRect.width / 2;
          let partCenterY = partRect.top + partRect.height / 2;

          let d = dist(mouseX, mouseY, partCenterX, partCenterY);
          let stretchFactor = map(d, 0, 100, 2, 1, true);

          if (d < 100) {
            // Условие для увеличения символов в радиусе 30px от курсора
            part.style.transform = `scale(${stretchFactor})`;
            part.style.filter = "blur(0.3px)"; // Увеличиваем степень размытия
          } else {
            part.style.transform = "scale(1)";
            part.style.filter = "none"; // Убираем размытие, если символ не увеличен
          }
        }
      }

      function mousePressed() {
        touchPoints.push({ x: mouseX, y: mouseY });
      }

      function mouseReleased() {
        touchPoints = [];
        resetTextStyles();
      }

      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
      }

      document.addEventListener(
        "touchstart",
        function (event) {
          event.preventDefault();
        },
        { passive: false }
      );

      document.addEventListener("touchend", function () {
        resetTextStyles();
      });

      function resetTextStyles() {
        for (let part of textParts) {
          part.style.transform = "scale(1) !important";
          part.style.filter = "none !important"; // Убираем размытие
        }
      }

      document.addEventListener("touchend", function () {
        console.log("touchend event triggered");
        resetTextStyles();
      });
    </script>
  </body>
</html>
