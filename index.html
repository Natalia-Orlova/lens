<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Cursor-based Graphics</title>
    <style>
      /* Add some basic styling to our canvas */
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="400" height="400"></canvas>
    <script>
      // Get the canvas element
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Define the w function
      function w(p, a, l, v) {
        let m = [
          -v[0] *
            Math.pow(
              Math.clamp(1 - Math.hypot(l[0] - p[0], l[1] - p[1]) / 190, 0, 1),
              2
            ) *
            1.5,
          -v[1] *
            Math.pow(
              Math.clamp(1 - Math.hypot(l[0] - p[0], l[1] - p[1]) / 190, 0, 1),
              2
            ) *
            1.5,
        ];
        let c = [0, 0, 0];
        for (let i = 0; i < 10; i++) {
          let s = 0.175 + 0.005 * i;
          c[0] += a.sample(p[0] + s * m[0], p[1] + s * m[1]).r;
          c[1] += a.sample(
            p[0] + (s + 0.025) * m[0],
            p[1] + (s + 0.025) * m[1]
          ).g;
          c[2] += a.sample(
            p[0] + (s + 0.05) * m[0],
            p[1] + (s + 0.05) * m[1]
          ).b;
        }
        return [c[0] / 10, c[1] / 10, c[2] / 10, 1];
      }

      // Add event listeners for mouse and touch events
      canvas.addEventListener("mousemove", (event) => {
        const pos = getCursorPosition(event);
        const layer = {
          /* your layer data */
        };
        const lightPos = [100, 100]; // Replace with your light position
        const viewDir = [0, 0]; // Replace with your view direction
        const result = w(pos, layer, lightPos, viewDir);
        // Render the result
        renderResult(result);
      });

      canvas.addEventListener("touchmove", (event) => {
        const pos = getTouchPosition(event);
        const layer = {
          /* your layer data */
        };
        const lightPos = [100, 100]; // Replace with your light position
        const viewDir = [0, 0]; // Replace with your view direction
        const result = w(pos, layer, lightPos, viewDir);
        // Render the result
        renderResult(result);
      });

      // Helper function to get the cursor position
      function getCursorPosition(event) {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        return [x, y];
      }

      // Helper function to get the touch position
      function getTouchPosition(event) {
        const rect = canvas.getBoundingClientRect();
        const touch = event.touches[0];
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        return [x, y];
      }

      // Helper function to render the result
      function renderResult(result) {
        // Use the result to render graphics on the canvas
        ctx.fillStyle = `rgba(${result[0] * 255}, ${result[1] * 255}, ${
          result[2] * 255
        }, 1)`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
    </script>
  </body>
</html>
